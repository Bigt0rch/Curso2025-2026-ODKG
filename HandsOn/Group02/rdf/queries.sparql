# Prefissi usati in tutte le query
PREFIX safeschool: <http://safeschool.linkeddata.es/ontology#>
PREFIX schema: <https://schema.org/>

# =========================================================================

# Query 1: Get the names and types of the first 10 educational centers.
# This query verifies that the basic mapping of centers is working.
SELECT ?center ?name ?type
WHERE {
  ?center a safeschool:EducationalCenter ;
          schema:name ?name ;
          schema:description ?type .
}
LIMIT 10

---

# Query 2: Find all public schools ("PÚBLICO") in the "Centro" district and their websites.
# This query checks if filtering by data properties works as expected.
SELECT ?center ?name ?website
WHERE {
  ?center a safeschool:EducationalCenter ;
          schema:name ?name ;
          safeschool:ownershipType "PÚBLICO" ;
          safeschool:inDistrict ?district .
  ?district schema:name "CENTRO" .
  OPTIONAL { ?center schema:url ?website . }
}

---

# Query 3: Get the WKT geometry for the educational center with code "28004059" (CERVANTES).
# This query verifies that the geometry data and district link were created correctly.
SELECT ?name ?geometry ?districtName
WHERE {
  ?center schema:identifier "28004059" ;
          schema:name ?name ;
          safeschool:wktGeometry ?geometry ;
          safeschool:inDistrict ?district .
  ?district schema:name ?districtName .
}

---

# Query 4: Count the number of educational centers in each district.
# This query is useful for aggregating data and verifying the transformation on a larger scale.
SELECT ?districtName (COUNT(?center) AS ?numberOfCenters)
WHERE {
    ?center a safeschool:EducationalCenter ;
            safeschool:inDistrict ?district .
    ?district schema:name ?districtName .
}
GROUP BY ?districtName
ORDER BY DESC(?numberOfCenters)

---

# Query 5: Count the total number of all educational centers.
# This query gives a final count to check if all rows from the CSV have been transformed.
SELECT (COUNT(?center) AS ?totalCenters)
WHERE {
  ?center a safeschool:EducationalCenter .
}

---

# Query 6: Get the first 10 accidents with pedestrians involved.
# This query verifies that the accident mapping is working correctly.
SELECT ?accident ?location ?date ?weather
WHERE {
  ?accident a safeschool:Accident ;
            schema:description ?location ;
            schema:startDate ?date ;
            safeschool:weatherCondition ?weather ;
            safeschool:pedestrianInvolved true .
}
LIMIT 10

---

# Query 7: Count accidents by district.
# This query verifies the link between accidents and districts.
SELECT ?districtName (COUNT(?accident) AS ?numberOfAccidents)
WHERE {
  ?accident a safeschool:Accident ;
            safeschool:inDistrict ?district .
  ?district schema:name ?districtName .
}
GROUP BY ?districtName
ORDER BY DESC(?numberOfAccidents)

---

# Query 8: Find accidents with positive alcohol or drug tests.
# This query checks boolean data properties.
SELECT ?accident ?location ?date ?alcohol ?drug
WHERE {
  ?accident a safeschool:Accident ;
            schema:description ?location ;
            schema:startDate ?date ;
            safeschool:alcoholPositive ?alcohol ;
            safeschool:drugPositive ?drug .
  FILTER(?alcohol = true || ?drug = true)
}
LIMIT 10

---

# Query 9: Get information about speed cameras.
# This query verifies that the speed camera mapping is working correctly.
SELECT ?camera ?location ?type ?speedLimit
WHERE {
  ?camera a safeschool:SpeedCamera ;
          schema:description ?location ;
          safeschool:cameraType ?type ;
          safeschool:speedLimit ?speedLimit .
}
LIMIT 10

---

# Query 10: Count total number of resources by type.
# This query gives an overview of all transformed data.
SELECT ?type (COUNT(?resource) AS ?count)
WHERE {
  ?resource a ?type .
  FILTER(?type IN (safeschool:Accident, safeschool:EducationalCenter, safeschool:SpeedCamera, safeschool:District))
}
GROUP BY ?type
ORDER BY DESC(?count)