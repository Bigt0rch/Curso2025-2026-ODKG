# Prefixes for vocabularies used in the mapping
@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix safeschool: <http://safeschool.linkeddata.es/ontology#>.
@prefix schema: <https://schema.org/>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@base <http://safeschool.linkeddata.es/mapping/> .

# Logical Source definition: the CSV file
<#CSVSource> a rml:LogicalSource;
  rml:source "centros_educativos-updated.csv"; # Name of the CSV file
  rml:referenceFormulation ql:CSV. # Specifies that the format is CSV

# TriplesMap for mapping Educational Center data
<#EducationalCenterMapping> a rr:TriplesMap;
  rml:logicalSource <#CSVSource>; # Uses the CSV source defined above

  # Subject Map: creates a unique URI for each educational center
  rr:subjectMap [
    # The template for the URI, using the center code as a unique identifier
    rr:template "http://safeschool.linkeddata.es/resource/EducationalCenter/{centro_codigo}";
    # Assigns the safeschool:EducationalCenter class to each created subject
    rr:class safeschool:EducationalCenter;
  ];

  # Predicate-Object Maps: link the subject to its properties
  rr:predicateObjectMap [
    rr:predicate safeschool:centerCode; # Predicate from the ontology
    rr:objectMap [ rml:reference "centro_codigo" ]; # Value taken from the "centro_codigo" column
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:centerName;
    rr:objectMap [ rml:reference "centro_nombre" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:centerTypeCode;
    rr:objectMap [ rml:reference "centro_tipo_codigo" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:centerType;
    rr:objectMap [ rml:reference "centro_tipo_descripcion" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:ownershipType;
    rr:objectMap [ rml:reference "centro_titularidad" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:streetType;
    rr:objectMap [ rml:reference "direccion_via_tipo" ];
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:streetName;
    rr:objectMap [ rml:reference "direccion_via_nombre" ];
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:postalCode;
    rr:objectMap [ rml:reference "direccion_codigo_postal" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:districtCode;
    rr:objectMap [ rml:reference "distrito_codigo" ];
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:districtName;
    rr:objectMap [ rml:reference "distrito_nombre" ];
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:phone;
    rr:objectMap [ rml:reference "contacto_telefono1" ];
  ];
  
  rr:predicateObjectMap [
    rr:predicate safeschool:contactWebsite;
    rr:objectMap [ 
      rml:reference "contacto_web";
      rr:datatype xsd:anyURI # Specifies that the value is a URI
    ];
  ];

  rr:predicateObjectMap [
    rr:predicate safeschool:contactEmail;
    rr:objectMap [ rml:reference "contacto_email1" ];
  ];
  
  # Map for an object that is another resource (not a literal)
  # Links the Educational Center to its geographic Location
  rr:predicateObjectMap [
    rr:predicate safeschool:locatedAt; # Predicate that links the two entities
    rr:objectMap [
      # The object is created by another TriplesMap (<#LocationMapping>)
      rr:parentTriplesMap <#LocationMapping>;
      # Join condition: links the rows from the two maps using the center code
      rr:joinCondition [
        rr:child "centro_codigo";
        rr:parent "centro_codigo";
      ];
    ];
  ].

# TriplesMap for mapping Location data
<#LocationMapping> a rr:TriplesMap;
  rml:logicalSource <#CSVSource>;
  
  # Subject Map for the Location
  rr:subjectMap [
    rr:template "http://safeschool.linkeddata.es/resource/Location/EducationalCenter/{centro_codigo}";
    rr:class safeschool:Location;
  ];

  # Map for the UTM X coordinate
  rr:predicateObjectMap [
    rr:predicate safeschool:utmX;
    rr:objectMap [ 
        rml:reference "coordenada_x_utm";
        rr:datatype xsd:integer; # Specifies that the value is an integer
    ];
  ];

  # Map for the UTM Y coordinate
  rr:predicateObjectMap [
    rr:predicate safeschool:utmY;
    rr:objectMap [ 
        rml:reference "coordenada_y_utm";
        rr:datatype xsd:integer;
    ];
  ].